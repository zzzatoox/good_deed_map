{% load static %}
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Передача прав - {{ nko.name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <link href="{% static 'css/add_nko.css' %}" rel="stylesheet" />
    <link href="{% static 'css/index.css' %}" rel="stylesheet" />
    <style>
      html,
      body {
        overflow-x: hidden;
        max-width: 100vw;
      }
      .nko-card {
        width: 100%;
        max-width: min(980px, 96vw);
        margin: 0 auto;
      }
      .nko-card input,
      .nko-card textarea,
      .nko-card select {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      .form-grid {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      @media (min-width: 768px) {
        .form-grid {
          display: grid;
          grid-template-columns: 2fr 1fr;
          gap: 1.5rem;
          align-items: start;
        }
      }
      @media (max-width: 480px) {
        .nko-card {
          border-radius: 1rem;
          padding: 1rem;
        }
        header {
          padding-left: 1rem;
          padding-right: 1rem;
        }
        header img {
          max-width: 140px;
        }
      }
      .categories-container {
        max-height: 40vh;
        overflow-y: auto;
      }
      @media (min-width: 768px) {
        .categories-container {
          max-height: 30vh;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans dark:bg-gray-900">
    <div class="fixed inset-0 z-0">
      <div id="background-carousel" class="relative w-full h-full">
        <div
          class="absolute inset-0 bg-cover bg-center bg-no-repeat blur opacity-70 transition-opacity duration-1000"
          style="background-image: url('{% static 'images/background1.jpg' %}')"
        ></div>
        <div
          class="absolute inset-0 bg-cover bg-center bg-no-repeat blur opacity-0 transition-opacity duration-1000"
          style="background-image: url('{% static 'images/background2.jpg' %}')"
        ></div>
        <div
          class="absolute inset-0 bg-cover bg-center bg-no-repeat blur opacity-0 transition-opacity duration-1000"
          style="background-image: url('{% static 'images/background3.jpg' %}')"
        ></div>
        <div
          class="absolute inset-0 bg-cover bg-center bg-no-repeat blur opacity-0 transition-opacity duration-1000"
          style="background-image: url('{% static 'images/background4.jpg' %}')"
        ></div>
        <div
          class="absolute inset-0 bg-cover bg-center bg-no-repeat blur opacity-0 transition-opacity duration-1000"
          style="background-image: url('{% static 'images/background5.jpg' %}')"
        ></div>
      </div>
      <div
        class="absolute inset-0 bg-black bg-opacity-30 dark:bg-opacity-50"
      ></div>
    </div>

    <header
      class="bg-white shadow-sm py-3 px-4 sm:px-6 flex items-center justify-between z-50 sticky top-0 dark:bg-gray-800"
    >
      <div class="flex items-center gap-6 md:gap-12">
        <div class="flex items-center gap-2">
          <a href="#" class="flex">
            <img
              src="{% static 'images/LOGO_ROSATOM.svg' %}"
              alt="Rosatom Logo"
              class="logo-light h-6 md:h-7"
            />
            <img
              src="{% static 'images/rosatom-logo.svg' %}"
              alt="Rosatom Logo White"
              class="logo-dark h-6 md:h-7"
            />
          </a>
        </div>
        <nav class="hidden md:block">
          <ul class="flex items-center gap-2">
            <li>
              <a
                href="{% url 'index' %}"
                class="text-sm font-medium text-gray-800 hover:text-[#68b114] hover:underline p-2 dark:text-gray-200 dark:hover:text-[#68b114] nav-home-link"
                >Карта добрых дел</a
              >
            </li>
          </ul>
        </nav>
      </div>
      <nav class="flex items-center gap-4">
        <button
          id="theme-toggle"
          class="p-2 rounded-full bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors dark:bg-gray-700 dark:text-yellow-300 dark:hover:bg-gray-600"
        >
          <svg
            id="moon-icon"
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
            />
          </svg>
          <svg
            id="sun-icon"
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 hidden"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
        {% if user.is_authenticated %}
        <a
          href="{% url 'logout' %}"
          class="ml-3 inline-block py-2 px-4 bg-white text-[#15256D] font-medium rounded-md shadow-sm hover:opacity-95 transition-colors logout-btn"
          >Выйти</a
        >
        {% else %}
        <a
          href="{% url 'login' %}"
          class="ml-3 inline-block py-2 px-4 bg-white text-[#15256D] font-medium rounded-md shadow-sm hover:opacity-95 transition-colors logout-btn"
          >Войти</a
        >
        {% endif %}
      </nav>
    </header>

    <main
      class="relative z-10 flex items-center justify-center min-h-[calc(100vh-80px)] py-4 px-3 sm:px-4"
    >
      <div
        class="nko-card bg-gradient-to-r from-[#15256D] to-[#4495D1] rounded-2xl sm:rounded-3xl shadow-xl p-4 sm:p-6 lg:p-8 dark:from-gray-800 dark:to-gray-700"
      >
        <h2
          class="text-xl sm:text-2xl font-extrabold text-white mb-4 sm:mb-6 text-center drop-shadow-lg dark:text-gray-100"
        >
          Передача прав на НКО "{{ nko.name }}"
        </h2>

        <form method="post" class="w-full">
          {% csrf_token %}

          <div class="form-grid">
            <div class="space-y-4 min-w-0">
              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Текущий владелец</label
                >
                <input
                  type="text"
                  readonly
                  class="w-full rounded-lg p-2 bg-white/20 text-white"
                  value="{{ nko.owner.get_full_name|default:nko.owner.username }}"
                />
              </div>

              {% for field in form %}
              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >{{ field.label }}</label
                >
                {% if field.name == 'new_owner_email' %} {{ field }} {{field.errors }} {% elif field.name == 'change_description' %} {{ field }} {{ field.errors }} {% else %} {{ field }} {{field.errors }} {% endif %} {% if field.help_text %}
                <p class="text-xs text-white/80 mt-1">{{ field.help_text }}</p>
                {% endif %}
              </div>
              {% endfor %}
            </div>

            <aside class="space-y-4 min-w-0">
              <div class="space-y-3">
                <button
                  type="submit"
                  class="w-full py-3 bg-white text-[#15256D] font-bold text-base sm:text-lg rounded-xl transition-all duration-300 shadow-lg dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500 hover:shadow-xl active:scale-95"
                >
                  Отправить запрос на передачу
                </button>

                <a
                    href="{% url 'index' %}"
                    class="block text-center text-center py-2 bg-white/20 text-white rounded-xl hover:opacity-90"
                    >Отмена</a
                  >
              </div>

              <div
                class="mt-4 rounded-md bg-yellow-50 p-3 text-sm text-yellow-800 dark:bg-yellow-900/40"
              >
                <strong>Внимание!</strong> После передачи прав вы больше не
                сможете редактировать эту НКО. Запрос будет отправлен на
                модерацию администраторам.
              </div>
            </aside>
          </div>
        </form>
      </div>
    </main>

    <script>
      (function () {
        let currentBackground = 0;
        const backgrounds = document.querySelectorAll(
          "#background-carousel > div"
        );
        function changeBackground() {
          if (!backgrounds || backgrounds.length === 0) return;
          backgrounds[currentBackground].classList.remove("opacity-70");
          backgrounds[currentBackground].classList.add("opacity-0");
          currentBackground = (currentBackground + 1) % backgrounds.length;
          backgrounds[currentBackground].classList.remove("opacity-0");
          backgrounds[currentBackground].classList.add("opacity-70");
        }
        setInterval(changeBackground, 5000);
      })();
    </script>
    <script type="module" src="{% static 'js/add_nko.js' %}"></script>
  </body>
</html>
