{% extends 'nko/nko_base.html' %}
{% load static %}

{% block title %}–ú–æ–∏ –∑–∞—è–≤–∫–∏ - –ö–∞—Ä—Ç–∞ –¥–æ–±—Ä—ã—Ö –¥–µ–ª{% endblock %}

{% block form_title %}–ú–æ–∏ –∑–∞—è–≤–∫–∏{% endblock %}

{% block form_content %}
<div class="w-full space-y-6">
    
    {# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ù–ö–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #}
    {% if user_nko %}
    <div class="bg-white/90 rounded-xl p-4 shadow-md dark:bg-gray-700">
        <h3 class="text-xl font-bold text-[#15256D] mb-2 dark:text-white">–í–∞—à–µ –ù–ö–û</h3>
        <p class="text-gray-800 dark:text-gray-200">
            <strong>{{ user_nko.name }}</strong>
        </p>
        <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">
            –°—Ç–∞—Ç—É—Å: 
            {% if user_nko.is_approved %}
                <span class="text-green-600 dark:text-green-400">‚úì –û–¥–æ–±—Ä–µ–Ω–æ</span>
            {% else %}
                <span class="text-orange-600 dark:text-orange-400">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
            {% endif %}
        </p>
        {% if user_nko.has_pending_changes %}
        <p class="text-sm text-yellow-600 dark:text-yellow-400 mt-1">
            ‚ö†Ô∏è –ï—Å—Ç—å –æ–∂–∏–¥–∞—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
        </p>
        {% endif %}
    </div>
    {% else %}
    <div class="bg-white/90 rounded-xl p-4 shadow-md dark:bg-gray-700">
        <p class="text-gray-800 dark:text-gray-200">
            –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ù–ö–û.
        </p>
        <a href="{% url 'add_nko' %}" class="inline-block mt-3 py-2 px-4 bg-[#4495D1] text-white rounded-xl hover:bg-[#2e7bb8]">
            –î–æ–±–∞–≤–∏—Ç—å –ù–ö–û
        </a>
    </div>
    {% endif %}

    {# –û–∂–∏–¥–∞—é—â–∏–µ –∑–∞—è–≤–∫–∏ #}
    {% if pending_versions %}
    <div class="bg-white/90 rounded-xl p-4 shadow-md dark:bg-gray-700">
        <h3 class="text-xl font-bold text-[#15256D] mb-4 dark:text-white">
            –ó–∞—è–≤–∫–∏ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ ({{ pending_versions.count }})
        </h3>
        
        <div class="space-y-4">
            {% for version in pending_versions %}
            <div class="border-l-4 border-orange-400 pl-4 py-2 bg-orange-50 rounded dark:bg-orange-900/20">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 dark:text-gray-200">
                            {% if version.new_owner %}
                                üîÑ –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–∞–≤
                            {% else %}
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                            {% endif %}
                        </p>
                        <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">
                            –î–∞—Ç–∞ –ø–æ–¥–∞—á–∏: {{ version.created_at|date:"d.m.Y H:i" }}
                        </p>
                        {% if version.change_description %}
                        <p class="text-sm text-gray-700 dark:text-gray-300 mt-2 italic">
                            "{{ version.change_description }}"
                        </p>
                        {% endif %}
                        {% if version.new_owner %}
                        <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">
                            –ù–æ–≤—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü: {{ version.new_owner.get_full_name|default:version.new_owner.username }}
                        </p>
                        {% endif %}
                    </div>
                    <span class="text-orange-600 dark:text-orange-400 text-sm font-medium">
                        ‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ #}
    {% if rejected_versions %}
    <div class="bg-white/90 rounded-xl p-4 shadow-md dark:bg-gray-700">
        <h3 class="text-xl font-bold text-[#15256D] mb-4 dark:text-white">
            –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ ({{ rejected_versions.count }})
        </h3>
        
        <div class="space-y-4">
            {% for version in rejected_versions %}
            <div class="border-l-4 border-red-500 pl-4 py-2 bg-red-50 rounded dark:bg-red-900/20">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 dark:text-gray-200">
                            {% if version.new_owner %}
                                üîÑ –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–∞–≤
                            {% else %}
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                            {% endif %}
                        </p>
                        <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">
                            –î–∞—Ç–∞ –ø–æ–¥–∞—á–∏: {{ version.created_at|date:"d.m.Y H:i" }}
                        </p>
                        {% if version.change_description %}
                        <p class="text-sm text-gray-700 dark:text-gray-300 mt-2 italic">
                            "{{ version.change_description }}"
                        </p>
                        {% endif %}
                        
                        {# –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞ #}
                        {% if version.rejection_reason %}
                        <div class="mt-3 p-3 bg-yellow-50 rounded border border-yellow-200 dark:bg-yellow-900/30 dark:border-yellow-700">
                            <p class="text-sm font-semibold text-yellow-800 dark:text-yellow-300 mb-1">
                                –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞:
                            </p>
                            <p class="text-sm text-gray-800 dark:text-gray-200">
                                {{ version.rejection_reason }}
                            </p>
                        </div>
                        {% endif %}
                    </div>
                    <span class="text-red-600 dark:text-red-400 text-sm font-medium">
                        ‚úó –û—Ç–∫–ª–æ–Ω–µ–Ω–æ
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ –æ–∂–∏–¥–∞—é—â–∏—Ö, –Ω–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ #}
    {% if not pending_versions and not rejected_versions and user_nko %}
    <div class="bg-white/90 rounded-xl p-4 shadow-md dark:bg-gray-700">
        <p class="text-gray-600 dark:text-gray-300 text-center">
            –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
        </p>
    </div>
    {% endif %}

    {# –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ #}
    <div class="text-center">
        <a
            href="{% url 'index' %}"
            class="inline-block py-3 px-6 bg-white text-[#15256D] font-bold rounded-xl hover:opacity-90 shadow-lg dark:bg-gray-600 dark:text-white"
        >
            –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
    </div>
</div>
{% endblock %}
