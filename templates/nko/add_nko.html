{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Новая НКО</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <link href="{% static 'css/add_nko.css' %}" rel="stylesheet" />
    <link href="{% static 'css/index.css' %}" rel="stylesheet" />
    <style>
      /* Убираем горизонтальную прокрутку */
      html,
      body {
        overflow-x: hidden;
        max-width: 100vw;
      }

      /* Делаем форму полностью адаптивной */
      .nko-card {
        width: 100%;
        max-width: min(980px, 96vw);
        margin: 0 auto;
      }

      /* Адаптивные поля ввода */
      .nko-card input,
      .nko-card textarea,
      .nko-card select {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }

      /* Адаптивная сетка */
      .form-grid {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      @media (min-width: 768px) {
        .form-grid {
          display: grid;
          grid-template-columns: 2fr 1fr;
          gap: 1.5rem;
          align-items: start;
        }
      }

      /* Улучшаем отображение на очень маленьких экранах */
      @media (max-width: 480px) {
        .nko-card {
          border-radius: 1rem;
          padding: 1rem;
        }

        header {
          padding-left: 1rem;
          padding-right: 1rem;
        }

        header img {
          max-width: 140px;
        }
      }

      /* Улучшаем скролл для категорий на мобильных */
      .categories-container {
        max-height: 40vh;
        overflow-y: auto;
      }

      @media (min-width: 768px) {
        .categories-container {
          max-height: 30vh;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans dark:bg-gray-900">
    <header
      class="bg-white shadow-sm py-3 px-4 sm:px-6 flex items-center justify-between z-50 sticky top-0 dark:bg-gray-800"
    >
      <div class="flex items-center gap-6 md:gap-12">
        <div class="flex items-center gap-2">
          <a href="#" class="flex">
            <!-- Light theme logo -->
            <img
              src="{% static 'images/LOGO_ROSATOM.svg' %}"
              alt="Rosatom Logo"
              class="logo-light h-6 md:h-7"
            />
            <!-- Dark theme logo -->
            <img
              src="{% static 'images/rosatom-logo.svg' %}"
              alt="Rosatom Logo White"
              class="logo-dark h-6 md:h-7"
            />
          </a>
        </div>
        <nav class="hidden md:block">
          <ul class="flex items-center gap-2">
            <li>
              <a
                href="{% url 'index' %}"
                class="text-sm font-medium text-gray-800 hover:text-[#68b114] hover:underline p-2 dark:text-gray-200 dark:hover:text-[#68b114] nav-home-link"
                >Карта добрых дел</a
              >
            </li>
          </ul>
        </nav>
      </div>
      <nav class="flex items-center gap-4">
        <button
          id="theme-toggle"
          class="p-2 rounded-full bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors dark:bg-gray-700 dark:text-yellow-300 dark:hover:bg-gray-600"
        >
          <!-- Moon Icon for Dark Mode -->
          <svg
            id="moon-icon"
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
            />
          </svg>
          <!-- Sun Icon for Light Mode -->
          <svg
            id="sun-icon"
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 hidden"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
        {% if user.is_authenticated %}
        <a
          href="{% url 'logout' %}"
          class="ml-3 inline-block py-2 px-4 bg-white text-[#15256D] font-medium rounded-md shadow-sm hover:opacity-95 transition-colors logout-btn"
        >
          Выйти
        </a>
        {% else %}
        <a
          href="{% url 'login' %}"
          class="ml-3 inline-block py-2 px-4 bg-white text-[#15256D] font-medium rounded-md shadow-sm hover:opacity-95 transition-colors logout-btn"
        >
          Войти
        </a>
        {% endif %}
      </nav>
    </header>

    <!-- Main content area -->
    <main
      class="flex items-center justify-center min-h-[calc(100vh-80px)] py-4 px-3 sm:px-4"
    >
      <!-- Main form container -->
      <div
        class="nko-card bg-gradient-to-r from-[#15256D] to-[#4495D1] rounded-2xl sm:rounded-3xl shadow-xl p-4 sm:p-6 lg:p-8 dark:from-gray-800 dark:to-gray-700"
      >
        <!-- Content within the card -->
        <h2
          class="text-xl sm:text-2xl font-extrabold text-white mb-4 sm:mb-6 text-center drop-shadow-lg dark:text-gray-100"
        >
          Добавить новое НКО
        </h2>

        <form method="post" enctype="multipart/form-data" class="w-full">
          {% csrf_token %} {{ form.non_field_errors }}

          <div class="form-grid">
            <!-- Main column -->
            <div class="space-y-4 min-w-0">
              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Название НКО</label
                >
                {{ form.name }} {{ form.name.errors }}
              </div>

              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Направление деятельности (можно выбрать несколько)</label
                >
                <div
                  class="categories-container bg-white bg-opacity-90 rounded-xl border-2 border-white p-3 sm:p-4 shadow-md dark:bg-gray-700 dark:border-gray-600"
                >
                  {{ form.categories }} {{ form.categories.errors }}
                </div>
              </div>

              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Описание НКО</label
                >
                {{ form.description }} {{ form.description.errors }}
              </div>

              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Функционал волонтеров (опционально)</label
                >
                {{ form.volunteer_functions }} {{ form.volunteer_functions.errors }}
              </div>

              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Адрес</label
                >
                {{ form.address }} {{ form.address.errors }}
              </div>
            </div>

            <!-- Sidebar -->
            <aside class="space-y-4 min-w-0">
              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Город</label
                >
                {{ form.city }} {{ form.city.errors }}
              </div>

              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Логотип (опционально)</label
                >
                <div
                  class="file-input-container bg-white bg-opacity-90 rounded-xl border-2 border-white p-3 shadow-md dark:bg-gray-700 dark:border-gray-600"
                >
                  {{ form.logo }} {{ form.logo.errors }}
                  <div
                    id="logo-validation"
                    class="file-validation-message"
                    aria-live="polite"
                  ></div>
                  <p
                    class="text-xs text-gray-700 mt-2 italic dark:text-gray-300"
                  >
                    * Допустимые форматы: PNG, JPG и JPEG
                  </p>
                </div>
              </div>

              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Сайт (опционально)</label
                >
                {{ form.website }} {{ form.website.errors }}
              </div>

              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Соцсеть (опционально)</label
                >
                {{ form.other_social }} {{ form.other_social.errors }}
              </div>

              <div>
                <label
                  class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
                  >Контактный телефон (опционально)</label
                >
                {{ form.phone }} {{ form.phone.errors }}
              </div>

              <div class="space-y-3">
                <button
                  type="submit"
                  class="w-full py-3 bg-white text-[#15256D] font-bold text-base sm:text-lg rounded-xl transition-all duration-300 shadow-lg dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500 hover:shadow-xl active:scale-95"
                >
                  Добавить НКО
                </button>

                <a
                  href="{% url 'index' %}"
                  class="block text-center text-white text-sm opacity-90 hover:opacity-100 hover:underline dark:text-gray-200"
                  >Вернуться на главную</a
                >
              </div>
            </aside>
          </div>
        </form>
      </div>
    </main>

    <script type="module" src="{% static 'js/add_nko.js' %}"></script>
  </body>
</html>
