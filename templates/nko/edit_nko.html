{% extends 'nko/nko_base.html' %} {% load static %} {# Заголовок страницы #} 
{% block title %}Редактировать НКО - {{ nko.name }}{% endblock %} 
{# Заголовок формы #} {% block form_title %}Редактировать НКО{% endblock %} 
{# Содержимое формы #} {% block form_content %}
<form method="post" enctype="multipart/form-data" class="w-full" id="ngo-form">
  {% csrf_token %}
  
  {# Общие ошибки формы #}
  {% if form.non_field_errors %}
  <div class="mb-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-3 rounded dark:bg-red-900/30 dark:text-red-200">
    {{ form.non_field_errors }}
  </div>
  {% endif %}

  <div class="form-grid">
    {# Основная колонка - первые 5 полей #}
    <div class="space-y-4 min-w-0">
      {% for field in form %} {% if forloop.counter0 < 5 %} 
      {% if field.name == 'categories' %}
      <div>
        <label
          class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
        >
          {{ field.label }}
        </label>
        <div
          class="categories-container bg-white bg-opacity-90 rounded-xl border-2 border-white p-3 sm:p-4 shadow-md dark:bg-gray-700 dark:border-gray-600"
        >
          {{ field }}
        </div>
        {% if field.errors %}
        <div class="mt-1 text-red-200 text-sm bg-red-500/20 border border-red-400 rounded p-2">
          {% for error in field.errors %}
          <p>❌ {{ error }}</p>
          {% endfor %}
        </div>
        {% endif %}
        {% if field.help_text %}
        <p class="text-xs text-white/80 mt-1">{{ field.help_text }}</p>
        {% endif %}
      </div>
      {% else %}
      <div>
        <label
          class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
        >
          {{ field.label }}
        </label>
        {{ field }}
        {% if field.errors %}
        <div class="mt-1 text-red-200 text-sm bg-red-500/20 border border-red-400 rounded p-2">
          {% for error in field.errors %}
          <p>❌ {{ error }}</p>
          {% endfor %}
        </div>
        {% endif %}
        {% if field.help_text %}
        <p class="text-xs text-white/80 mt-1">{{ field.help_text }}</p>
        {% endif %}
      </div>
      {% endif %} {% endif %} {% endfor %}
    </div>

    {# Боковая колонка - остальные поля #}
    <aside class="space-y-4 min-w-0">
      {% for field in form %} {% if forloop.counter0 >= 5 %}
       {% if field.name == 'logo' %}
      <div>
        <label
          class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
        >
          {{ field.label }}
        </label>
        <div
          class="file-input-container bg-white bg-opacity-90 rounded-xl border-2 border-white p-3 shadow-md dark:bg-gray-700 dark:border-gray-600"
        >
          {{ field }}
          <div
            id="logo-validation"
            class="file-validation-message"
            aria-live="polite"
          ></div>
          <p class="text-xs text-gray-700 mt-2 italic dark:text-gray-300">
            * Допустимые форматы: PNG, JPG и JPEG
          </p>
        </div>
        {% if field.errors %}
        <div class="mt-1 text-red-200 text-sm bg-red-500/20 border border-red-400 rounded p-2">
          {% for error in field.errors %}
          <p>❌ {{ error }}</p>
          {% endfor %}
        </div>
        {% endif %}
        {% if field.help_text %}
        <p class="text-xs text-white/80 mt-1">{{ field.help_text }}</p>
        {% endif %}
      </div>
      {% else %}
      <div>
        <label
          class="block text-white text-sm font-medium mb-2 dark:text-gray-200"
        >
          {{ field.label }}
        </label>
        {{ field }}
        {% if field.errors %}
        <div class="mt-1 text-red-200 text-sm bg-red-500/20 border border-red-400 rounded p-2">
          {% for error in field.errors %}
          <p>❌ {{ error }}</p>
          {% endfor %}
        </div>
        {% endif %}
        {% if field.help_text %}
        <p class="text-xs text-white/80 mt-1">{{ field.help_text }}</p>
        {% endif %}
      </div>
      {% endif %} {% endif %} {% endfor %} {# Кнопки #}
      <div class="space-y-3">
        <button
          type="submit"
          class="w-full py-3 bg-white text-[#15256D] font-bold text-base sm:text-lg rounded-xl transition-all duration-300 shadow-lg dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500 hover:shadow-xl active:scale-95"
        >
          Сохранить изменения
        </button>

        <div class="flex gap-2">
          <a
            href="{% url 'index' %}"
            class="block w-1/2 text-center py-2 bg-white/20 text-white rounded-xl hover:opacity-90"
          >
            Отмена
          </a>
          <a
            href="{% url 'transfer_ownership' nko.pk %}"
            class="block w-1/2 text-center py-2 bg-yellow-500 text-white rounded-xl hover:opacity-90"
          >
            Передать права
          </a>
        </div>
      </div>
    </aside>
  </div>

  {# Предупреждение о модерации #}
  <div
    class="mt-4 rounded-md bg-yellow-50 p-3 text-sm text-yellow-800 dark:bg-yellow-50 dark:text-yellow-800"
  >
    <strong>Внимание!</strong> Изменения будут отправлены на модерацию
    администраторам. Пока изменения не одобрены, на карте будет отображаться
    старая информация.
  </div>
</form>
{% endblock %}
{# Hidden latitude/longitude inputs (filled by JS) #}
<div style="display:none;">
  {{ form.latitude }}
  {{ form.longitude }}
</div>
